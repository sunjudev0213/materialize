# Copyright Materialize, Inc. All rights reserved.
#
# Use of this software is governed by the Business Source License
# included in the LICENSE file at the root of this repository.
#
# As of the Change Date specified in that file, in accordance with
# the Business Source License, use of this software will be governed
# by the Apache License, Version 2.0.

mode cockroach

statement ok
CREATE MATERIALIZED VIEW v AS SELECT 1 AS a, 2 AS b, 3 AS c
----

statement ok
CREATE INDEX idx1 ON v (b)
----

# SHOW INDEXES

query TTTTTT colnames
SHOW INDEXES FROM v
----
On_name               Key_name                          Column_name Expression Null  Seq_in_index
materialize.public.v  materialize.public.idx1           b           NULL       false 1
materialize.public.v  materialize.public.v_primary_idx  a           NULL       false 1
materialize.public.v  materialize.public.v_primary_idx  b           NULL       false 2
materialize.public.v  materialize.public.v_primary_idx  c           NULL       false 3

query TTTTTT colnames
SHOW INDEXES FROM v WHERE Column_name = 'b'
----
On_name               Key_name                          Column_name Expression Null  Seq_in_index
materialize.public.v  materialize.public.idx1           b           NULL       false 1
materialize.public.v  materialize.public.v_primary_idx  b           NULL       false 2

query TTTTTT colnames
SHOW INDEXES FROM v WHERE Column_name = 'd'
----
On_name               Key_name                 Column_name Expression Null  Seq_in_index

# Reference a different column

query TTTTTT colnames
SHOW INDEXES FROM v WHERE Key_name = 'materialize.public.idx1'
----
On_name               Key_name                 Column_name Expression Null  Seq_in_index
materialize.public.v  materialize.public.idx1  b           NULL       false 1

query TTTTTT colnames
SHOW INDEXES FROM v WHERE key_name LIKE '%v'
----
On_name               Key_name                 Column_name Expression Null  Seq_in_index

# TODO(justin): not handled in parser yet:
#   SHOW INDEXES FROM v LIKE '%v'
